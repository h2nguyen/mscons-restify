# API Generation

## Introduction

EDIFACT MSCONS Parser is a REST-API application (MSCONSRestify) based on Python's FastAPI framework.
The API endpoints of the application are generated by OpenAPI Generator using the provided OpenAPI
YAML specification.

The main OpenAPI specification of the application is described in this file:
[docs/edifact-mscons-parser.openapi.yaml](edifact-mscons-parser.openapi.yaml).

## Usage of OpenAPI Generator

See installation instructions for OpenAPI Generator [here](https://github.com/OpenAPITools/openapi-generator#1---installation) and for
available generators, both for client and server sides [here](https://github.com/OpenAPITools/openapi-generator/blob/master/docs/generators.md).

### Generate the EDIFACT MSCONS Parser API Server

To facilitate the work, one can run Docker to generate the server endpoints from
the *.openapi.yaml file via Docker CLI:

```shell
docker run --rm \
  -v ${PWD}:/local openapitools/openapi-generator-cli generate \
  -p packageName=msconsparser.adapters.inbound.rest \
  -i /local/docs/edifact-mscons-parser.openapi.yaml \
  -g python-fastapi \
  -o /local
```

## Configuration

For detailed configuration options when generating Python FastAPI projects, refer to the official documentation:

- [Python FastAPI Generator Documentation](https://github.com/OpenAPITools/openapi-generator/blob/master/docs/generators/python-fastapi.md)

## Next Steps

After generating the API endpoints, you may need to:

1. Review the generated code and make any necessary adjustments
   - The generated code is not git-committed, thus the REST API application can only run after you have generated the endpoints. 
2. Integrate the generated endpoints with your existing application
3. Implement the business logic for each endpoint
   - Currently, all implementations are within this folder: [impl](../src/msconsparser/adapters/inbound/rest/impl), which is also git-committed.
4. Run tests to ensure everything works as expected

> **IMPORTANT NOTE:**
> 
> The OpenAPI generator for `python-fastapi` is currently in beta phase and has a known limitation (bug)
> where the request body media-type `text/plain` is not properly rendered in the Swagger-UI. As a workaround, the
> required media-type configuration
> ```
> async def parse_mscons_raw_format(
>    body: Annotated[...] = Body(None, description="...", media_type="text/plain"),
> ) -> Dict[str, object]:
> ```
> has been manually added in
> [**mscons_parser_api.py**](../src/msconsparser/adapters/inbound/rest/apis/mscons_parser_api.py) as well as the
> `examples preview`, which is why this file is included in version control. Once this issue is resolved in a future
> release of the OpenAPI generator, this file should be excluded from version control and generated automatically.
>
> **IMPORTANT:** After generating the files from the provided OpenAPI specification
> [**edifact-mscons-parser.openapi.yaml**](edifact-mscons-parser.openapi.yaml),
> the [**mscons_parser_api.py**](../src/msconsparser/adapters/inbound/rest/apis/mscons_parser_api.py) file needs to be
> rollbacked, since the generation process overwrites the existing file. This is necessary due to the aforementioned bug.
